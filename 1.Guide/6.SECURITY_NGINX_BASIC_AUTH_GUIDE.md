# Hướng Dẫn (Bảo mật): Cài đặt Mật khẩu cho Website bằng Nginx Basic Authentication

## Giới thiệu

Đây là phương pháp được khuyến nghị để bảo vệ ứng dụng của bạn một cách nhanh chóng và hiệu quả. Chúng ta sẽ sử dụng tính năng "Basic Authentication" của web server Nginx để yêu cầu tên đăng nhập và mật khẩu trước khi bất kỳ ai có thể xem nội dung trang web.

**Quan trọng:** Hướng dẫn này nên được thực hiện **SAU KHI** bạn đã kích hoạt HTTPS thành công bằng Certbot (xem Hướng dẫn 6).

**Lưu ý cho Môi trường nhiều Dự án:** Hướng dẫn này đã được cập nhật để tạo một file mật khẩu **riêng biệt** cho dự án `ditavn.tababyco.com`. Đây là cách làm tốt nhất để đảm bảo mỗi dự án trên cùng một VPS có một lớp bảo mật độc lập.

**Ưu điểm:**
-   **An toàn cao:** Mật khẩu được kiểm tra ở cấp độ web server, trước khi yêu cầu được chuyển đến ứng dụng Node.js.
-   **Triển khai nhanh:** Chỉ mất vài phút để cấu hình.
-   **Bảo vệ toàn diện:** Cả frontend và backend API đều được bảo vệ.
-   **Không cần sửa code:** Toàn bộ cấu hình nằm trong Nginx.

---

## Các bước Thực hiện

### Bước 1: Cài đặt Công cụ tạo Mật khẩu

Chúng ta cần một công cụ gọi là `htpasswd` để tạo file mật khẩu đã được mã hóa. Công cụ này nằm trong gói `apache2-utils`.

1.  Kết nối vào VPS của bạn qua SSH.
2.  Chạy lệnh sau để cài đặt:
    ```bash
    sudo apt update
    sudo apt install apache2-utils -y
    ```

### Bước 2: Tạo File Mật khẩu Riêng cho Dự án

Lệnh này sẽ tạo một file mới, được đặt tên theo dự án của bạn, trong thư mục `/etc/nginx/`.

1.  Chạy lệnh sau. Hãy thay `your_admin_user` bằng tên đăng nhập bạn muốn.
    ```bash
    sudo htpasswd -c /etc/nginx/.htpasswd-ditavn.tababyco.com teamamz
    ```
    -   **Lưu ý:** Tùy chọn `-c` (create) chỉ được dùng cho **lần đầu tiên** để tạo file. Nếu sau này bạn muốn thêm một người dùng khác, hãy bỏ tùy chọn `-c` đi.

2.  Bạn sẽ được nhắc nhập và xác nhận mật khẩu mới. Hãy nhập một mật khẩu đủ mạnh và ghi nhớ nó.

### Bước 3: Cập nhật Cấu hình Nginx

Sau khi Certbot đã chạy thành công, file cấu hình của bạn sẽ được nâng cấp lên HTTPS. Bây giờ, chúng ta sẽ thêm lớp bảo mật mật khẩu vào đó.

1.  **Mở file cấu hình Nginx của trang web bạn:**
    ```bash
    sudo nano /etc/nginx/sites-available/ditavn.tababyco.com
    ```
2.  **Thay thế toàn bộ nội dung file:**
    -   Xóa tất cả nội dung hiện có trong file.
    -   Sao chép và dán toàn bộ nội dung từ file mẫu `nginx_config_https_auth_example.txt`.
    -   File mẫu này đã bao gồm tất cả các thiết lập SSL từ Certbot và các dòng `auth_basic` cần thiết được đặt ở đúng vị trí. Điều này đảm bảo cấu hình của bạn là hoàn chỉnh và chính xác.

3.  Lưu file và thoát trình soạn thảo (nhấn `Ctrl + X`, sau đó `Y`, và `Enter`).

### Bước 4: Kiểm tra và Khởi động lại Nginx

1.  Luôn kiểm tra cú pháp file cấu hình trước khi khởi động lại.
    ```bash
    sudo nginx -t
    ```
    -   Nếu bạn thấy thông báo `syntax is ok` và `test is successful`, mọi thứ đã sẵn sàng.

2.  Áp dụng các thay đổi bằng cách khởi động lại Nginx:
    ```bash
    sudo systemctl restart nginx
    ```

---

## Hoàn tất!

Bây giờ, hãy thử truy cập vào trang web `https://ditavn.tababyco.com` của bạn. Trình duyệt sẽ hiện lên một hộp thoại yêu cầu bạn nhập tên người dùng và mật khẩu đã tạo ở Bước 2. Các dự án khác trên VPS của bạn sẽ không bị ảnh hưởng.